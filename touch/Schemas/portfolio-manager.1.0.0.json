{
  "key": "portfolio-manager",
  "version": "1.0.0",
  "domain": "touch",
  "flow": "sys-schemas",
  "flowVersion": "1.0.0",
  "tags": [
    "new"
  ],
  "attributes": {
    "type": "schema",
    "schema": {
      "$schema": "https://json-schema.org/draft/2020-12/schema",
      "$id": "https://schemas.touch.domain/portfolio-manager",
      "title": "Portfolio Manager",
      "type": "object",
      "description": "Portfolio Manager master schema",
      "properties": {
        "user": {
          "type": "string",
          "description": "Reference to User entity in different domain for portfolio manager's personal information (name, surname, phone, etc.) (format: domain:workflow:key or domain:workflow:id)"
        },
        "person": {
          "type": "string",
          "description": "Reference to Person entity in different domain for portfolio manager's personal information (format: domain:workflow:key or domain:workflow:id)"
        },
        "delegates": {
          "type": "array",
          "description": "Array of Portfolio Manager references who can respond on behalf when this manager is unavailable. System will automatically route requests to delegates when manager is offline, busy, on-vacation, or away.",
          "items": {
            "type": "string",
            "description": "Reference to another Portfolio Manager (format: touch:portfolio-manager:key or touch:portfolio-manager:id)"
          },
          "uniqueItems": true
        },
        "timezone": {
          "type": "string",
          "description": "IANA timezone identifier (e.g., 'Europe/Istanbul', 'America/New_York')",
          "pattern": "^[A-Za-z_]+/[A-Za-z_]+$"
        },
        "availableSlotDurations": {
          "type": "array",
          "description": "Available appointment slot durations in minutes (must be multiples of 15, e.g., 15, 30, 60)",
          "items": {
            "type": "integer",
            "minimum": 15,
            "multipleOf": 15,
            "description": "Slot duration in minutes (must be a multiple of 15)"
          },
          "minItems": 1,
          "uniqueItems": true
        },
        "breakDurationBetweenAppointments": {
          "type": "integer",
          "description": "Break duration between two consecutive appointments in minutes (must be a multiple of 15, minimum 15)",
          "minimum": 15,
          "multipleOf": 15,
          "default": 15
        },
        "useDefaultWorkingHours": {
          "type": "boolean",
          "description": "If true, uses default working hours from appsettings.json configuration. If false, uses custom workingHours defined below.",
          "default": true
        },
        "workingHours": {
          "type": "object",
          "description": "Custom working hours for this portfolio manager. Supports multiple time ranges per day (e.g., morning and afternoon sessions with lunch break). Only used when useDefaultWorkingHours is false.",
          "properties": {
            "monday": {
              "type": "array",
              "description": "Working hours for Monday. Empty array means closed.",
              "items": {
                "$ref": "#/$defs/timeRange"
              }
            },
            "tuesday": {
              "type": "array",
              "description": "Working hours for Tuesday. Empty array means closed.",
              "items": {
                "$ref": "#/$defs/timeRange"
              }
            },
            "wednesday": {
              "type": "array",
              "description": "Working hours for Wednesday. Empty array means closed.",
              "items": {
                "$ref": "#/$defs/timeRange"
              }
            },
            "thursday": {
              "type": "array",
              "description": "Working hours for Thursday. Empty array means closed.",
              "items": {
                "$ref": "#/$defs/timeRange"
              }
            },
            "friday": {
              "type": "array",
              "description": "Working hours for Friday. Empty array means closed.",
              "items": {
                "$ref": "#/$defs/timeRange"
              }
            },
            "saturday": {
              "type": "array",
              "description": "Working hours for Saturday. Empty array means closed.",
              "items": {
                "$ref": "#/$defs/timeRange"
              }
            },
            "sunday": {
              "type": "array",
              "description": "Working hours for Sunday. Empty array means closed.",
              "items": {
                "$ref": "#/$defs/timeRange"
              }
            }
          },
          "required": [
            "monday",
            "tuesday",
            "wednesday",
            "thursday",
            "friday",
            "saturday",
            "sunday"
          ]
        }
      },
      "$defs": {
        "timeRange": {
          "type": "object",
          "description": "A time range within a day",
          "properties": {
            "start": {
              "type": "string",
              "pattern": "^([01]?[0-9]|2[0-3]):[0-5][0-9]$",
              "description": "Start time in HH:mm format (e.g., '09:00')"
            },
            "end": {
              "type": "string",
              "pattern": "^([01]?[0-9]|2[0-3]):[0-5][0-9]$",
              "description": "End time in HH:mm format (e.g., '18:00')"
            }
          },
          "required": [
            "start",
            "end"
          ]
        }
      },
      "required": [
        "user",
        "person",
        "timezone",
        "availableSlotDurations",
        "breakDurationBetweenAppointments"
      ],
      "additionalProperties": false
    }
  }
}
